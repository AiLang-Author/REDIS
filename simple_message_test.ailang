// simple_message_test.ailang
// Test message passing using hash tables as mailboxes

PrintMessage("=== Simple Message Test ===")

// Create mailboxes using hash tables
mailbox1 = HashCreate()
mailbox2 = HashCreate()

// Actor 1 sends message to Actor 2
LoopActor.Actor1 {
    HashSet(mailbox2, "msg", 100)
    PrintMessage("Actor1: Sent 100 to Actor2")
}

// Actor 2 receives and replies
LoopActor.Actor2 {
    msg = HashGet(mailbox2, "msg")
    PrintMessage("Actor2: Received:")
    PrintNumber(msg)
    
    reply = Multiply(msg, 2)
    HashSet(mailbox1, "reply", reply)
    PrintMessage("Actor2: Sent reply (x2)")
}

// Actor 1 gets reply
LoopActor.Actor1Reply {
    reply = HashGet(mailbox1, "reply")
    PrintMessage("Actor1: Got reply:")
    PrintNumber(reply)
}

// Run the sequence
h1 = LoopSpawn("Actor1")
h2 = LoopSpawn("Actor2")
h3 = LoopSpawn("Actor1Reply")

LoopYield()  // Actor1 sends
LoopYield()  // Actor2 receives and replies
LoopYield()  // Actor1 gets reply

PrintMessage("Expected: 100 sent, 200 received")
PrintMessage("=== Test Complete ===")